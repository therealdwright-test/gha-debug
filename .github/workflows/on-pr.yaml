name: Pull Request

on:
  pull_request:
    branches: [ '**' ]

permissions: write-all

jobs:
  check-out-code:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

  fake-dependent-step:
    strategy:
      matrix:
        instance: [1, 2, 3, 4]
    runs-on: ubuntu-latest
    needs: check-out-code
    steps:
      - name: Fake doing some work
        shell: bash
        run: |
          echo "Starting to do some work on instance ${{ matrix.instance }}..."
          # We'll divide the 45 seconds into 9 intervals of 5 seconds each for demonstration
          for i in {1..9}; do
              echo "Working on task $i of 9..."
              sleep 5
          done
          echo "Work completed for instance ${{ matrix.instance }}!"

  # this is here as we need to the logical and of three conditions (status checks passed & PR approved & mergable)
  final-sync-check:
    needs: fake-dependent-step
    name: Check if manual ArgoCD sync is required
    uses: ./.github/workflows/manual-sync.yaml
